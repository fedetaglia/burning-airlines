

<%= link_to 'Create Airplane', "#new", id:'new-plane', class: 'btn btn-default' %>

<div id="form">
<%= render 'form' %>
</div>

<div id="table">
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Rows</th>
        <th>Columns</th>
        <th></th>
        <th></th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <% @airplanes.each do |airplane| %>
        <tr>
          <td><%= link_to airplane.name,"", id:"#{airplane.id}", :class => "plane" %></td>
          <td><%= airplane.rows %></td>
          <td><%= airplane.columns %></td>
          <td><%= link_to 'Show', airplane %></td>
          <td><%= link_to 'Edit', edit_airplane_path(airplane) %></td>
          <td><%= link_to 'Destroy', airplane, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
<div id="diagram">

</div>

<div id="token"><%= form_authenticity_token %></div>


<script>
  $('#form').hide();

  $('#new-plane').on('click', function(){
    $('#form').toggle();
  })


  $(document).ready(function() {

  $('#create-new').on('click',function(e){
    e.preventDefault();

    var planeName = $('#new-name').val()
    var planeRows = $('#new-rows').val()
    var planeColumns = $('#new-columns').val()
    
    var saveOption = {
      url: '/airplanes',
      type: 'post',
      dataType: 'json',
      data: { 
        airplane: {
          name: planeName, 
          rows: planeRows, 
          columns: planeColumns, 
          token: $('#token').html() 
        }
      }
    }

    var savePlane = $.ajax(saveOption);

    savePlane.done(function(plane){
      var diagram = planeDiagram(plane);
      $('#diagram').append(diagram)
      }).fail(function(){
      alert('cant save it!');
      })


    var planeDiagram = function(plane){
      var $plane = plane
      var seatDiv = '<div class="glyphicon glyphicon-plane"></div>'
      var planeDiv = '<div class="airplane"></div>'

      for( var x = 1; x <= $plane.rows ; x = x+1 ){
          var row  = '<div class"row"></div>'
          for ( var i = 1; i <= $plane.columns; i = i+1 ) {
            row = $(row).append(seatDiv)
          }
          planeDiv = $(planeDiv).append(row)          
        }
      return planeDiv
      } // planeDiagram

  }) // create on click


}) // document ready


</script>




